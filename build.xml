<!DOCTYPE project>

<project name="proactive_grid_cloud_portal" default="compile" basedir=".">

	<property name="project-name" value="ProActive Grid Cloud Portal" />


	<property file="./build.properties" />

	<!-- to generate a release uncomment the variable rest_api.version -->
	<!-- in the build.properties file, then launch the generation of the war file -->

	<tstamp>
		<format property="rest_api.version" pattern="yyyyMMddHHmm" locale="en,UK" />
	</tstamp>


	<property name="build.dir" value="build" />
	<property name="classes.dir" value="${build.dir}/classes" />
	<property name="lib.dir" value="lib" />
	<property name="war.root" value="WebContent" />
	<property name="webinf" value="${war.root}/WEB-INF" />
	<property name="webinf.lib.dir" value="${war.root}/WEB-INF/lib" />
	<property name="webinf.classes.dir" value="${war.root}/WEB-INF/classes" />
	<property name="webinf.lib.doc" value="${war.root}/WEB-INF/doc" />
	<property name="src.dir" value="src" />


	<!-- 
		 Compile all
	-->

	<target name="prepare" description="Create dir for class files">
		<mkdir dir="${classes.dir}" />
		<mkdir dir="${webinf.lib.dir}" />
		<mkdir dir="${war.root}/doc" />
		<copy todir="${webinf.classes.dir}">
			<fileset dir="${webinf}">
				<include name="log4j.properties" />
			</fileset>
		</copy>
	</target>

	<target name="clean" description="Delete class files">
		<delete dir="${classes.dir}" />
		<delete dir="${webinf.classes.dir}" />
		<delete dir="${webinf.lib.dir}" />
		<delete dir="${war.root}/doc" />
	</target>

	<path id="src.classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>
		<pathelement location="${classes.dir}" />
		<fileset dir="${ant.library.dir}">
			<include name="**/*.jar" />
	 	</fileset>
	</path>

	<!-- NB: all the source files are the project source files -->

	<target name="compile" depends="prepare" description="Compiles the Java source code">
		<echo message="Compiling src files" />
		<javac srcdir="${src.dir}" destdir="${classes.dir}" deprecation="false" failonerror="true" debug="true">
			<classpath refid="src.classpath" />
		</javac>
		
		<taskdef name="stubGenerator" classname="ant.AntStubGenerator" classpathref="src.classpath" />
		<typedef name="class" classname="ant.AntStubGeneratorClass" classpathref="src.classpath" />
		
		<stubGenerator srcDir="${classes.dir}" refclasspath="src.classpath">
				<class name="org.ow2.proactive_grid_cloud_portal.scheduler.MyCachingSchedulerProxyUserInterface" />
		</stubGenerator>
		
	</target>


	<target name="war" depends="compile,doc,schedulingrest-common-jar,schedulingrest-scheduler-jar,schedulingrest-rm-jar" description="Generate the war file">
		<!-- copy classes -->
		<!--
		<copy todir="WebContent/WEB-INF/classes">
			<fileset dir="build/classes">
				<include name="**" />
			</fileset>
		</copy>
	    -->
		<!-- copy jars -->
		<copy todir="${webinf.lib.dir}" flatten="true">
			<fileset dir="${lib.dir}/scheduling">
				<include name="**/*.jar" />
			</fileset>
			<fileset dir="${lib.dir}/resteasy">
				<include name="**/*.jar" />
			</fileset>
		</copy>

		<!-- copy doc content -->
		<copy todir="${war.root}/doc">
			<fileset dir="${build.dir}/jaxrsdocs/">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy todir="${war.root}/doc">
			<fileset dir="${build.dir}/">
				<include name="jaxbdocs/" />
			</fileset>
		</copy>

		<war destfile="SchedulingRest-${rest_api.version}.war" webxml="${webinf}/web.xml" basedir="${war.root}">
			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="ActiveEon" />
				<attribute name="Implementation-Title" value="Scheduling Rest Api" />
				<!-- -->
				<attribute name="Implementation-Version" value="${rest_api.version}" />
				<attribute name="Specification-Version" value="${scheduler.version}" />
			</manifest>
		</war>
	</target>

	<target name="doc" depends="doc-jaxrs">

	</target>


	<target name="doc-jaxrs" depends="doc-jaxb" description="Generate JAX-RS documentation">
		<javadoc classpathref="src.classpath" sourcepath="${src.dir}" destdir="${build.dir}/jaxrsdocs/" extdirs="${lib.dir}" doclet="com.lunatech.doclets.jax.jaxrs.JAXRSDoclet" docletpathref="src.classpath" footer="Copyright 2007-2011 Activeeon All Rights Reserved. ">
			<package name="org.ow2.proactive_grid_cloud_portal.*" />
			<link href="jaxbdocs/" />
		</javadoc>
	</target>


	<target name="doc-jaxb" description="Generate JAXB documentation">
		<javadoc classpathref="src.classpath" sourcepath="${src.dir}" destdir="${build.dir}/jaxbdocs/" extdirs="${lib.dir}" doclet="com.lunatech.doclets.jax.jaxb.JAXBDoclet" docletpathref="src.classpath" footer="Copyright 2007-2011 Activeeon All Rights Reserved. ">
			<package name="org.ow2.proactive_grid_cloud_portal.*" />
		</javadoc>
	</target>

	<target name="schedulingrest-common-jar" depends="compile" description="create the jar containing the common files of scheduling rest">
		<jar jarfile="${webinf.lib.dir}/schedulingrest-common-${rest_api.version}.jar">
			<fileset dir="${classes.dir}">
				<include name="org/ow2/proactive_grid_cloud_portal/common/**" />
			</fileset>
			<fileset dir="${classes.dir}">
				<include name="org/ow2/proactive_grid_cloud_portal/webapp/**" />
			</fileset>
			<fileset dir="${classes.dir}">
				<include name="org/ow2/proactive_grid_cloud_portal/test/**" />
			</fileset>
			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="ActiveEon" />
				<attribute name="Implementation-Title" value="Scheduling Rest Common" />
				<!-- -->
				<attribute name="Implementation-Version" value="${rest_api.version}" />
				<attribute name="Specification-Version" value="${scheduler.version}" />
			</manifest>
		</jar>
	</target>

	<target name="schedulingrest-rm-jar" depends="compile" description="create the jar containing the rm files of scheduling rest">
		<jar jarfile="${webinf.lib.dir}/schedulingrest-rm-${rest_api.version}.jar">
			<fileset dir="${classes.dir}">
				<include name="org/ow2/proactive_grid_cloud_portal/rm/**" />
			</fileset>


			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="ActiveEon" />
				<attribute name="Implementation-Title" value="Scheduling Rest Resource Manager" />
				<!-- -->
				<attribute name="Implementation-Version" value="${rest_api.version}" />
				<attribute name="Specification-Version" value="${scheduler.version}" />

			</manifest>
		</jar>
	</target>

	<target name="schedulingrest-scheduler-jar" depends="compile" description="create the jar containing the scheduler files of scheduling rest">
		<jar jarfile="${webinf.lib.dir}/schedulingrest-scheduler-${rest_api.version}.jar">
			<fileset dir="${classes.dir}">
				<include name="org/ow2/proactive_grid_cloud_portal/scheduler/**" />
				<include name="pa/stub/org/ow2/proactive_grid_cloud_portal/scheduler/**" />
			</fileset>
			<manifest>
				<!-- Who is building this jar? -->
				<attribute name="Built-By" value="${user.name}" />
				<!-- Information about the program itself -->
				<attribute name="Implementation-Vendor" value="ActiveEon" />
				<attribute name="Implementation-Title" value="Scheduling Rest Scheduler" />
				<!-- -->
				<attribute name="Implementation-Version" value="${rest_api.version}" />
				<attribute name="Specification-Version" value="${scheduler.version}" />
			</manifest>
		</jar>
	</target>

</project>
